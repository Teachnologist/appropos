<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<!--move to stylesheet-->

<body >
<!--Navbar-->
<div th:fragment="ticker_marquee (pair,pair_value,investment_value,moving_average)" style="width:100%;height: 240px; color:blue;display: inline-flex;border:solid; border-width:thin;">
    <div style="width:70%;height: 100%; color:blue;">
        <h1 style="font-size:5vmax;text-align:center;" id="current_value" th:text="${pair_value}">4910.55</h1>
        <h4 style="font-size:1.5vmax;text-align:center;" id="pair" th:text="${pair}">BTC-USD</h4>
    </div>

    <div style="width:28%;height: 100%; color:green;">
        <div style="width:100%;height: 48%; color:orange;border-bottom:solid;border-bottom-width:thin;border-color:blue;">
            <h1 style="font-size:3.75vmin;text-align:center;" id="investment_value" th:text="${investment_value}">4909.55</h1>
            <h4 style="font-size:1.25vmin;text-align:center;">MY INVESTMENT</h4>
        </div>
        <div style="width:100%;height: 48%; color:black;">
            <h1 style="font-size:3.75vmin;text-align:center;" id="moving_average" th:text="${moving_average}">4909.55</h1>
            <h4 style="font-size:1.25vmin;text-align:center;">AVERAGE</h4>
        </div>

    </div>
    <script>
        if (!!window.EventSource) {
            console.log("Event source available");

            var pair = document.getElementById("pair").innerText;
            console.log("PAIR");
            console.log(pair);
            console.log("PAIR");
            var source_url = "/sse/demo/charts/marqueeTicker/"+pair
            var source = new EventSource(source_url);

            source.addEventListener('message', function(e) {
                console.log("ticker data");
                console.dir(e.data);
                var d = JSON.parse(e.data);
                console.dir(d);
                writeToTicker(JSON.parse(e.data));
            });

            source.addEventListener('open', function(e) {
                console.log("Connection was opened.");
            }, false);

            source.addEventListener('error', function(e) {
                if (e.readyState == EventSource.CLOSED) {
                    console.dir(e);
                    console.log("Connection was closed.");
                } else {
                    console.log(e.readyState);
                }
            }, false);

            function writeToTicker(data){
                for(var key in data){
                    document.getElementById(key).innerHTML = data[key];
                }

            }
        } else {
            console.log("No SSE available");
        }
    </script>

        <!--Add style here
        Use media queries for size
        -->
</div>

</body>
</html>
